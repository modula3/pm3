<HTML>
<HEAD>
<TITLE>Instantiating generics</TITLE>
</HEAD>
<BODY>

<H1>Instantiating generics</H1>
<P>

These procedures generate derived interfaces and modules for
instantiating generic interfaces and modules, respectively.
<P>

<B>build_generic_intf (nm, generic, args, vis)</B>
	Generate a derived interface named (in the file "nm.i3") that
	instantiates the generic interface named "generic" with the
	argument interfaces named in the list "args". The "vis" parameter
	controls the visibility of the derived interface, and should
	be one of the readonly constants <CODE>VISIBLE</CODE> or
        <CODE>HIDDEN</CODE>.
<P>

<B>build_generic_unsafe_intf (nm, generic, args, vis)</B>
	Like <B>build_generic_intf</B>, but the generated file
	instantiates an <CODE>UNSAFE</CODE> <CODE>INTERFACE</CODE>.
<P>

<B>build_generic_impl (nm, generic, args)</B>
	Generate a derived module name "nm" (in the file "nm.m3") that
	instantiates the generic module named "generic" with the
	argument interfaces named in the list "args".
<P>

<B>build_generic_unsafe_impl (nm, generic, args)</B>
	Like <B>build_generic_impl</B>, but the generated file
	instantiates an <CODE>UNSAFE</CODE> <CODE>MODULE</CODE>.
<P>

<H2>Example</H2>

<P>The above quake procedures are most commonly used in quake templates
associated with packages that export generic interfaces and
implementations. For example, consider the template file "list.tmpl",
which provides procedures for instantiating the generic "List" and
"ListSort" interfaces and modules. First, the procedures for
instantiating "List":

<PRE>
  readonly proc _list (nm, elt, vis) is
    local list = nm &amp; "List"
    build_generic_intf (list, "List", [elt], vis)
    build_generic_impl (list, "List", [elt])
  end
  
  readonly proc List (nm, elt) is _list (nm, elt, VISIBLE) end
  readonly proc list (nm, elt) is _list (nm, elt, HIDDEN)  end
</PRE>

<P> The last two procedures are meant to be used by clients. They come
in two forms: "List" instantiates a visible interface, and "list"
instantiates a hidden one. These two procedures take the name to be
used for the prefix of the instantiated files and the name of the
actual interface to use in the instantiation. Often, "nm" and "elt"
will be the same, but this design allows "nm" to be an abbreviated
form of the full interface name. For example, the standard lists are
instantiated by the following calls:

<PRE>
  List ("Atom", "Atom")
  List ("Int",  "Integer")
  List ("Ref",  "Refany")
  List ("Text", "Text")
</PRE>

<P> After these calls, a client can <CODE>IMPORT</CODE> the interfaces
named <CODE>AtomList</CODE>, <CODE>IntList</CODE>,
<CODE>RefList</CODE>, and <CODE>TextList</CODE>. The m3makefile will
automatically generate the files named "AtomList.i3", "AtomList.m3",
"IntList.i3", IntList.m3", etc. in the derived directory. For example,
the contents of the file "IntList.i3" will be:

<PRE>
  (* generated by m3build *)
  INTERFACE IntList = List (Integer) END IntList.
</PRE>

<P> The "list.tmpl" template also defines procedures for instantiating
the generic "ListSort" interface:

<PRE>
  readonly proc _list_sort (nm, elt, vis) is
    local list = nm &amp; "List"
    local listsort = nm &amp; "ListSort"
    build_generic_intf (listsort, "ListSort", [elt, list], vis)
    build_generic_impl (listsort, "ListSort", [elt])
  end
  
  readonly proc List_sort (nm, elt) is _list_sort (nm, elt, VISIBLE) end
  readonly proc list_sort (nm, elt) is _list_sort (nm, elt, HIDDEN)  end
</PRE>

<P> These procedures are similar to the ones above except that the
generic "ListSort" interface takes <I>two</I> parameters: the first is
the interface that defines the type <CODE>T</CODE> used as the list's
element type, and the second is the name of the <CODE>List</CODE> type
ranging over that type.

<P> There are analogous calls in the list package's m3makefile for
instantiating standard instances of this type:

<PRE>
  List_sort ("Atom", "Atom")
  List_sort ("Int",  "Integer")
  List_sort ("Ref",  "Refany")
  List_sort ("Text", "Text")
</PRE>

<P> This produces files named "AtomListSort.i3", "AtomListSort.m3",
"IntListSort.i3", "IntListSort.m3", etc. in the derived directory.
Here is the contents of the generated file "IntListSort.i3":

<PRE>
  (* generated by m3build *)
  INTERFACE IntListSort = ListSort (Integer, IntList) END IntListSort.
</PRE>

<P> Several packages define new quake procedure for instantiating
generics, such as generic <A HREF="generics.html">lists, queues,
sequences, and tables</A>. To see how these are coded, look at the
".tmpl" template files in the "src" directory of the relevant packages.
<P>

<PRE>
Last modified on Mon Feb 12 17:08:02 PST 1996 by heydon 
</PRE>
<!--Copyright (C) 1992, 1996, Digital Equipment Corporation. All rights reserved.-->
</BODY>
</HTML>
